<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scalaz/concurrent/Strategy.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scalaz
<span class="keyword">package</span> concurrent

<span class="keyword">import</span> <a href="../Scalaz.scala.html#19020" title="object scalaz.Scalaz">Scalaz</a>._
<span class="keyword">import</span> java.util.concurrent.{ExecutorService, ThreadFactory, Executors}

/**
 * Evaluate an expression in some specific manner. A typical strategy will schedule asynchronous
 * evaluation and return a function that, when called, will block until the result is ready.
 */
<span class="keyword">trait</span> <a title="trait Strategy extends java.lang.Object" id="22183">Strategy</a> <a title="java.lang.Object" id="2744">{</a>
  <span class="keyword">def</span> <a title="[A](a: =&gt; A)() =&gt; A" id="52222">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="52224">A</a>](<a title="=&gt; A" id="113875">a</a>: =&gt; A): () =&gt; A
}

<span class="keyword">abstract</span> <span class="keyword">class</span> <a title="class StrategyLow extends java.lang.Object with ScalaObject" id="22231">StrategyLow</a> <span title="ScalaObject">{</span>
  /**
   * A strategy that evaluates its argument in the current thread.
   */
  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scalaz.concurrent.Strategy" id="90058">Sequential</a>: <a href="#22183" title="scalaz.concurrent.Strategy">Strategy</a> = <a href="#394575" title="java.lang.Object with scalaz.concurrent.Strategy" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.concurrent.Strategy" id="394575">Strategy</a> {
    <span class="keyword">def</span> <a title="[A](a: =&gt; A)() =&gt; A" id="394579">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="394581">A</a>](<a title="=&gt; A" id="394582">a</a>: =&gt; A) = {
      <span class="keyword">val</span> <a title="A" id="394590">v</a> = <a href="#394582" title="=&gt; A">a</a>
      () =&gt; <a href="#394590" title="A">v</a>
    }
  }

  <span class="keyword">import</span> java.util.concurrent.ExecutorService

  /**
   * A strategy that evaluates its arguments using an implicit ExecutorService.
   */
  <span class="keyword">implicit</span> <span class="keyword">def</span> <a title="implicit scalaz.concurrent.StrategyLow.Executor : (implicit s: java.util.concurrent.ExecutorService)java.lang.Object with scalaz.concurrent.Strategy" id="90061">Executor</a>(<span class="keyword">implicit</span> <a title="java.util.concurrent.ExecutorService" id="394600">s</a>: <span title="java.util.concurrent.ExecutorService">ExecutorService</span>) = <a href="#394603" title="java.lang.Object with scalaz.concurrent.Strategy" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.concurrent.Strategy" id="394603">Strategy</a> {
    <span class="keyword">import</span> java.util.concurrent.Callable
    <span class="keyword">def</span> <a title="[A](a: =&gt; A)() =&gt; A" id="394606">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="394608">A</a>](<a title="=&gt; A" id="394609">a</a>: =&gt; A) = {
      <span class="keyword">val</span> <a title="java.util.concurrent.Future[A]" id="394617">fut</a> = <a href="#394600" title="java.util.concurrent.ExecutorService">s</a>.<a title="(x$1: java.util.concurrent.Callable[A])java.util.concurrent.Future[A]" id="394626">submit</a>(<a href="#394698" title="java.lang.Object with java.util.concurrent.Callable[A]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with java.util.concurrent.Callable[A]" id="394698">Callable</a>[A] {
        <span class="keyword">def</span> <a title="()A" id="394700">call</a> = <a href="#394609" title="=&gt; A">a</a>
      })
      () =&gt; <a href="#394617" title="java.util.concurrent.Future[A]">fut</a>.<a title="()A" id="394685">get</a>
    }
  }

  /**
   * A strategy that performs no evaluation of its argument.
   */
  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scalaz.concurrent.Strategy" id="90062">Id</a>: <a href="#22183" title="scalaz.concurrent.Strategy">Strategy</a> = <a href="#394740" title="java.lang.Object with scalaz.concurrent.Strategy" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.concurrent.Strategy" id="394740">Strategy</a> {
    <span class="keyword">def</span> <a title="[A](a: =&gt; A)() =&gt; A" id="394744">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="394746">A</a>](<a title="=&gt; A" id="394747">a</a>: =&gt; A) = () =&gt; <a href="#394747" title="=&gt; A">a</a>
  }

  /**
   * A simple strategy that spawns a new thread for every evaluation.
   */
  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scalaz.concurrent.Strategy" id="90064">Naive</a>: <a href="#22183" title="scalaz.concurrent.Strategy">Strategy</a> = <a href="#394764" title="java.lang.Object with scalaz.concurrent.Strategy" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.concurrent.Strategy" id="394764">Strategy</a> {
    <span class="keyword">import</span> scala.concurrent.<span title="object scala.concurrent.ops">ops</span>.future
    <span class="keyword">def</span> <a title="[A](a: =&gt; A)() =&gt; A" id="394769">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="394771">A</a>](<a title="=&gt; A" id="394772">a</a>: =&gt; A) = <a title="object scala.concurrent.ops" id="395011">future</a> <a title="scala.concurrent.FutureTaskRunner" id="395024">{</a><a href="#394772" title="() =&gt; A" id="395056">a</a>}
  }

  /**
   * A strategy that evaluates its arguments using the pool of Swing worker threads.
   */
  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scalaz.concurrent.Strategy" id="90066">SwingWorker</a>: <a href="#22183" title="scalaz.concurrent.Strategy">Strategy</a> = <a href="#395074" title="java.lang.Object with scalaz.concurrent.Strategy" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.concurrent.Strategy" id="395074">Strategy</a> {
    <span class="keyword">import</span> javax.swing.SwingWorker
    <span class="keyword">def</span> <a title="[A](a: =&gt; A)() =&gt; A" id="395079">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="395081">A</a>](<a title="=&gt; A" id="395082">a</a>: =&gt; A) = {
      <span class="keyword">val</span> <a title="javax.swing.SwingWorker[A,Unit]" id="395090">worker</a> = <a href="#395091" title="javax.swing.SwingWorker[A,Unit]" class="keyword">new</a> <a title="anonymous class $anon extends javax.swing.SwingWorker[A,Unit]" id="395091">SwingWorker</a>[A, Unit] {
        <span class="keyword">def</span> <a title="()A" id="397261">doInBackground</a> = <a href="#395082" title="=&gt; A">a</a>
      }
      <a href="#395090" title="javax.swing.SwingWorker[A,Unit]">worker</a>.<a title="()Unit" id="396660">execute</a>
      () =&gt; <a href="#395090" title="javax.swing.SwingWorker[A,Unit]">worker</a>.<a title="()A" id="396665">get</a>
    }
  }

  /**
   * A strategy that evaluates its arguments on the Swing Event Dispatching thread.
   */
  <span class="keyword">implicit</span> <span class="keyword">val</span> <a title="scalaz.concurrent.Strategy" id="90068">SwingInvokeLater</a>: <a href="#22183" title="scalaz.concurrent.Strategy">Strategy</a> = <a href="#397285" title="java.lang.Object with scalaz.concurrent.Strategy" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.concurrent.Strategy" id="397285">Strategy</a> {
    <span class="keyword">import</span> javax.swing.SwingUtilities
    <span class="keyword">import</span> SwingUtilities.invokeLater
    <span class="keyword">import</span> java.util.concurrent.{Callable, FutureTask}
    <span class="keyword">def</span> <a title="[A](a: =&gt; A)() =&gt; A" id="397292">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="397294">A</a>](<a title="=&gt; A" id="397295">a</a>: =&gt; A) = {
      <span class="keyword">val</span> <a title="java.util.concurrent.FutureTask[A]" id="397303">task</a> = <span title="java.util.concurrent.FutureTask[A]" class="keyword">new</span> <a title="java.util.concurrent.FutureTask[A]" id="38760">FutureTask</a>[A](<a href="#397340" title="java.lang.Object with java.util.concurrent.Callable[A]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with java.util.concurrent.Callable[A]" id="397340">Callable</a>[A] {
        <span class="keyword">def</span> <a title="()A" id="397344">call</a> = <a href="#397295" title="=&gt; A">a</a>
      })
      <a title="(x$1: java.lang.Runnable)Unit" id="396418">invokeLater</a>(<a href="#397303" title="java.util.concurrent.FutureTask[A]">task</a>)
      () =&gt; <a href="#397303" title="java.util.concurrent.FutureTask[A]">task</a>.<a title="()A" id="397321">get</a>
    }
  }
}

<span class="keyword">object</span> <a title="object scalaz.concurrent.Strategy" id="22184">Strategy</a> <span title="ScalaObject" class="keyword">extends</span> <a href="#22231" title="scalaz.concurrent.StrategyLow">StrategyLow</a> {
  /**
   * The default executor service is a fixed thread pool with N daemon threads,
   * where N is equal to the number of available processors.
   */
  <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.util.concurrent.ExecutorService" id="90072">DefaultExecutorService</a>: <span title="java.util.concurrent.ExecutorService">ExecutorService</span> = {
    <span class="keyword">import</span> Executors._
    <a title="(x$1: Int,x$2: java.util.concurrent.ThreadFactory)java.util.concurrent.ExecutorService" id="398627">newFixedThreadPool</a>(<a title="object java.lang.Runtime" id="2255">Runtime</a>.<a title="()java.lang.Runtime" id="398734">getRuntime</a>.<a title="()Int" id="398763">availableProcessors</a>, <a href="#398792" title="java.lang.Object with java.util.concurrent.ThreadFactory" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with java.util.concurrent.ThreadFactory" id="398792">ThreadFactory</a> {
      <span class="keyword">def</span> <a title="(r: java.lang.Runnable)java.lang.Thread" id="398796">newThread</a>(<a title="java.lang.Runnable" id="398797">r</a>: <a title="java.lang.Runnable" id="2644">Runnable</a>) = {
        <span class="keyword">val</span> <a title="java.lang.Thread" id="399163">t</a> = <a title="()java.util.concurrent.ThreadFactory" id="398648">defaultThreadFactory</a>.<a title="(x$1: java.lang.Runnable)java.lang.Thread" id="398685">newThread</a>(<a href="#398797" title="java.lang.Runnable">r</a>)
        <a href="#399163" title="java.lang.Thread">t</a>.<a title="(x$1: Boolean)Unit" id="399139">setDaemon</a>(<span title="Boolean(true)" class="keyword">true</span>)
        <a href="#399163" title="java.lang.Thread">t</a>
      }
    })
  }

  /**
   * A strategy that executes its arguments on {@Strategy#DefaultExecutorService}.
   */
  <span class="keyword">implicit</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scalaz.concurrent.Strategy" id="90074">DefaultStrategy</a>: <a href="#22183" title="scalaz.concurrent.Strategy">Strategy</a> = <a href="#90061" title="implicit scalaz.concurrent.StrategyLow.Executor : (implicit s: java.util.concurrent.ExecutorService)java.lang.Object with scalaz.concurrent.Strategy">Executor</a>(<a href="#90071" title="=&gt; java.util.concurrent.ExecutorService">DefaultExecutorService</a>)
}

        </pre>
    </body>
</html>