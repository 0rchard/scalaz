<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>scalaz/effects/ST.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> scalaz
<span class="keyword">package</span> effects

<span class="keyword">import</span> <a href="../Scalaz.scala.html#19020" title="object scalaz.Scalaz">Scalaz</a>._

<span class="keyword">private</span>[effects] case <span class="keyword">class</span> <a title="class World[A] extends java.lang.Object with ScalaObject with Product" id="401785">World</a>[<a title="&gt;: Nothing &lt;: Any" id="399224">A</a>]<span title="ScalaObject">(</span>)
<span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait RealWorld extends java.lang.Object" id="22520">RealWorld</a>

/** Mutable variable in state thread S containing a value of type A. */
<span class="keyword">class</span> <a title="class STRef[S, A] extends java.lang.Object with ScalaObject" id="22595">STRef</a>[<a title="&gt;: Nothing &lt;: Any" id="22720">S</a>, <a title="&gt;: Nothing &lt;: Any" id="22721">A</a>]<span title="ScalaObject">(</span><a title="A" id="401415">a</a>: <a href="#22721" title="A">A</a>) {
  <span class="keyword">private</span> <span class="keyword">var</span> <a title="A" id="399401">value</a>: <a href="#22721" title="A">A</a> = <a href="#401415" title="A">a</a>

  /** Reads the value pointed at by this reference. */
  <span class="keyword">def</span> <a title="=&gt; scalaz.effects.ST[S,A]" id="399403">read</a>: <a href="#22535" title="scalaz.effects.ST[S,A]">ST</a>[S, A] = <a href="package.scala.html#27937" title="(a: =&gt; A)scalaz.effects.ST[S,A]">returnST</a>(<a href="#399401" title="=&gt; A">value</a>)

  /** Modifies the value at this reference with the given function. */
  <span class="keyword">def</span> <a title="[B](f: (A) =&gt; A)scalaz.effects.ST[S,scalaz.effects.STRef[S,A]]" id="399404">mod</a>[<a title="&gt;: Nothing &lt;: Any" id="399406">B</a>](<a title="(A) =&gt; A" id="401046">f</a>: A =&gt; A): <a href="#22535" title="scalaz.effects.ST[S,scalaz.effects.STRef[S,A]]">ST</a>[S, STRef[S, A]] = <a href="#401426" title="(f: (scalaz.effects.World[S]) =&gt; (scalaz.effects.World[S], scalaz.effects.STRef[S,A]))java.lang.Object with scalaz.effects.ST[S,scalaz.effects.STRef[S,A]]">ST</a>((s: <a href="#401785" title="scalaz.effects.World[S]">World</a>[S]) =&gt; {<a href="#399401" title="(x$1: A)Unit">value</a> = <a href="#401046" title="(v1: A)A">f</a>(<a href="#399401" title="=&gt; A">value</a>); <span title="(_1: scalaz.effects.World[S],_2: scalaz.effects.STRef[S,A])(scalaz.effects.World[S], scalaz.effects.STRef[S,A])">(</span><a href="#401461" title="scalaz.effects.World[S]">s</a>, <a href="#22595" title="scalaz.effects.STRef[S,A]" class="keyword">this</a>)})

  /** Associates this reference with the given value. */
  <span class="keyword">def</span> <a title="(a: =&gt; A)scalaz.effects.ST[S,scalaz.effects.STRef[S,A]]" id="399407">write</a>(<a title="=&gt; A" id="401026">a</a>: =&gt; A): <a href="#22535" title="scalaz.effects.ST[S,scalaz.effects.STRef[S,A]]">ST</a>[S, STRef[S, A]] = <a href="#401426" title="(f: (scalaz.effects.World[S]) =&gt; (scalaz.effects.World[S], scalaz.effects.STRef[S,A]))java.lang.Object with scalaz.effects.ST[S,scalaz.effects.STRef[S,A]]">ST</a>((s: <a href="#401785" title="scalaz.effects.World[S]">World</a>[S]) =&gt; {<a href="#399401" title="(x$1: A)Unit">value</a> = <a href="#401026" title="=&gt; A">a</a>; <span title="(_1: scalaz.effects.World[S],_2: scalaz.effects.STRef[S,A])(scalaz.effects.World[S], scalaz.effects.STRef[S,A])">(</span><a href="#401482" title="scalaz.effects.World[S]">s</a>, <a href="#22595" title="scalaz.effects.STRef[S,A]" class="keyword">this</a>)})

  /** Swap the value at this reference with the value at another. */
  <span class="keyword">def</span> <a title="(that: scalaz.effects.STRef[S,A])scalaz.effects.ST[S,Unit]" id="399408">swap</a>(<a title="scalaz.effects.STRef[S,A]" id="401495">that</a>: <a href="#22595" title="scalaz.effects.STRef[S,A]">STRef</a>[S, A]): <a href="#22535" title="scalaz.effects.ST[S,Unit]">ST</a>[S, Unit] = <span class="keyword">for</span> {
    <a title="A" id="401504">v1</a> &lt;- <a href="#22595" title="STRef.this.type" class="keyword">this</a>.<a href="#57277" title="(g: (A) =&gt; scalaz.effects.ST[S,Unit])scalaz.effects.ST[S,Unit]">read</a>
    <a title="A" id="401508">v2</a> &lt;- <a href="#401495" title="scalaz.effects.STRef[S,A]">that</a>.<a href="#57277" title="(g: (A) =&gt; scalaz.effects.ST[S,Unit])scalaz.effects.ST[S,Unit]">read</a>
    <a title="scalaz.effects.STRef[S,A]" id="401514">_</a> &lt;- <a href="#399407" title="(a: =&gt; A)scalaz.effects.ST[S,scalaz.effects.STRef[S,A]]" class="keyword">this</a> <a href="#57277" title="(g: (scalaz.effects.STRef[S,A]) =&gt; scalaz.effects.ST[S,Unit])scalaz.effects.ST[S,Unit]">write</a> <a href="#401508" title="A">v2</a>
    <a title="scalaz.effects.STRef[S,A]" id="401520">_</a> &lt;- <a href="#399407" title="(a: =&gt; A)scalaz.effects.ST[S,scalaz.effects.STRef[S,A]]">that</a> <a href="#57280" title="(g: (scalaz.effects.STRef[S,A]) =&gt; Unit)scalaz.effects.ST[S,Unit]">write</a> <a href="#401504" title="A">v1</a>
  } <span class="keyword">yield</span> <span title="Unit">(</span>)
}

/** Mutable array in state thread S containing values of type A. */
<span class="keyword">class</span> <a title="class STArray[S, A] extends java.lang.Object with ScalaObject" id="22565">STArray</a>[<a title="&gt;: Nothing &lt;: Any" id="22722">S</a>, <a title="&gt;: Nothing &lt;: Any" id="22723">A</a>:Manifest](<span class="keyword">val</span> <a title="Int" id="401552">size</a>: <span title="Int">Int</span>, <a title="A" id="401553">z</a>: <a href="#22723" title="A">A</a>) {
  <span class="keyword">private</span> <span class="keyword">val</span> <a title="Array[A]" id="401537">value</a>: <a title="Array[A]" id="2028">Array</a>[A] = <a title="object Array" id="2029">Array</a>.<a title="(n: Int)(elem: =&gt; A)(implicit evidence$9: scala.reflect.ClassManifest[A])Array[A]" id="28261">fill</a>(<a href="#401552" title="=&gt; Int">size</a>)<a href="#401535" title="Manifest[A]">(</a><a href="#401553" title="A">z</a>)

  /** Reads the value at the given index. */
  <span class="keyword">def</span> <a title="(i: Int)scalaz.effects.ST[S,A]" id="401539">read</a>(<a title="Int" id="401596">i</a>: <span title="Int">Int</span>): <a href="#22535" title="scalaz.effects.ST[S,A]">ST</a>[S, A] = <a href="package.scala.html#27937" title="(a: =&gt; A)scalaz.effects.ST[S,A]">returnST</a>(<a href="#401537" title="(i: Int)A" id="28169">value</a>(<a href="#401596" title="Int">i</a>))

  /** Writes the given value to the array, at the given offset. */
  <span class="keyword">def</span> <a title="(i: Int,a: A)scalaz.effects.ST[S,scalaz.effects.STArray[S,A]]" id="401540">write</a>(<a title="Int" id="401604">i</a>: <span title="Int">Int</span>, <a title="A" id="401605">a</a>: <a href="#22723" title="A">A</a>): <a href="#22535" title="scalaz.effects.ST[S,scalaz.effects.STArray[S,A]]">ST</a>[S, STArray[S, A]] = <a href="#401426" title="(f: (scalaz.effects.World[S]) =&gt; (scalaz.effects.World[S], scalaz.effects.STArray[S,A]))java.lang.Object with scalaz.effects.ST[S,scalaz.effects.STArray[S,A]]">ST</a>(<a title="scalaz.effects.World[S]" id="401613">s</a> =&gt; {<a href="#401537" title="(i: Int,x: A)Unit" id="28171">value</a>(<a href="#401604" title="Int">i</a>) = <a href="#401605" title="A">a</a>; <span title="(_1: scalaz.effects.World[S],_2: scalaz.effects.STArray[S,A])(scalaz.effects.World[S], scalaz.effects.STArray[S,A])">(</span><a href="#401613" title="scalaz.effects.World[S]">s</a>, <a href="#22565" title="scalaz.effects.STArray[S,A]" class="keyword">this</a>)})

  /** Turns a mutable array into an immutable one which is safe to return. */
  <span class="keyword">def</span> <a title="=&gt; scalaz.effects.ST[S,scalaz.ImmutableArray[A]]" id="401541">freeze</a>: <a href="#22535" title="scalaz.effects.ST[S,scalaz.ImmutableArray[A]]">ST</a>[S, ImmutableArray[A]] = <a href="#401426" title="(f: (scalaz.effects.World[S]) =&gt; (scalaz.effects.World[S], scalaz.ImmutableArray[A]))java.lang.Object with scalaz.effects.ST[S,scalaz.ImmutableArray[A]]">ST</a>(<a title="scalaz.effects.World[S]" id="401636">s</a> =&gt; <span title="(_1: scalaz.effects.World[S],_2: scalaz.ImmutableArray[A])(scalaz.effects.World[S], scalaz.ImmutableArray[A])">(</span><a href="#401636" title="scalaz.effects.World[S]">s</a>, <a href="../ImmutableArray.scala.html#15384" title="object scalaz.ImmutableArray">ImmutableArray</a>.<a href="../ImmutableArray.scala.html#172467" title="(x: Array[A])scalaz.ImmutableArray[A]">fromArray</a>(<a href="#401537" title="=&gt; Array[A]">value</a>)))

  /** Fill this array from the given association list. */
  <span class="keyword">def</span> <a title="[B](f: (A, B) =&gt; A,xs: Traversable[(Int, B)])scalaz.effects.ST[S,Unit]" id="401542">fill</a>[<a title="&gt;: Nothing &lt;: Any" id="401544">B</a>](<a title="(A, B) =&gt; A" id="401652">f</a>: (A, B) =&gt; A, <a title="Traversable[(Int, B)]" id="401653">xs</a>: <a title="Traversable[(Int, B)]" id="8308">Traversable</a>[(Int, B)]): <a href="#22535" title="scalaz.effects.ST[S,Unit]">ST</a>[S, Unit] = <a href="#401653" title="Traversable[(Int, B)]">xs</a> <span title="scalaz.effects.ST[S,Unit]" class="keyword">match</span> {
    <span title="scalaz.effects.ST[S,Unit]" class="keyword">case</span> <a title="object Nil" id="29464">Nil</a> =&gt; <a href="package.scala.html#27937" title="(a: =&gt; Unit)scalaz.effects.ST[S,Unit]">returnST</a>(<span title="Unit">(</span>))
    <span title="scalaz.effects.ST[S,Unit]" class="keyword">case</span> ((<a title="Int" id="401668">i</a>, <a title="B" id="401669">v</a>) :: <a title="List[(Int, B)]" id="401671">ivs</a>) =&gt; <span class="keyword">for</span> {
      <a title="Unit" id="401712">_</a> &lt;- <a href="#401545" title="(f: (A, B) =&gt; A,i: Int,v: B)scalaz.effects.ST[S,Unit]">update</a><a href="#57277" title="(g: (Unit) =&gt; scalaz.effects.ST[S,Unit])scalaz.effects.ST[S,Unit]">(</a><a href="#401652" title="(A, B) =&gt; A">f</a>, <a href="#401668" title="Int">i</a>, <a href="#401669" title="B">v</a>)
      <a title="Unit" id="401727">_</a> &lt;- <a href="#401542" title="(f: (A, B) =&gt; A,xs: Traversable[(Int, B)])scalaz.effects.ST[S,Unit]">fill</a><a href="#57280" title="(g: (Unit) =&gt; Unit)scalaz.effects.ST[S,Unit]">(</a><a href="#401652" title="(A, B) =&gt; A">f</a>, <a href="#401671" title="List[(Int, B)]">ivs</a>)
    } <span class="keyword">yield</span> <span title="Unit">(</span>)
  }

  /** Combine the given value with the value at the given index, using the given function. */
  <span class="keyword">def</span> <a title="[B](f: (A, B) =&gt; A,i: Int,v: B)scalaz.effects.ST[S,Unit]" id="401545">update</a>[<a title="&gt;: Nothing &lt;: Any" id="401547">B</a>](<a title="(A, B) =&gt; A" id="401673">f</a>: (A, B) =&gt; A, <a title="Int" id="401674">i</a>: <span title="Int">Int</span>, <a title="B" id="401675">v</a>: <a href="#401547" title="B">B</a>) = <span class="keyword">for</span> {
    <a title="A" id="401683">x</a> &lt;- <a href="#401539" title="(i: Int)scalaz.effects.ST[S,A]">read</a><a href="#57277" title="(g: (A) =&gt; scalaz.effects.ST[S,Unit])scalaz.effects.ST[S,Unit]">(</a><a href="#401674" title="Int">i</a>)
    <a title="scalaz.effects.STArray[S,A]" id="401692">_</a> &lt;- <a href="#401540" title="(i: Int,a: A)scalaz.effects.ST[S,scalaz.effects.STArray[S,A]]">write</a><a href="#57280" title="(g: (scalaz.effects.STArray[S,A]) =&gt; Unit)scalaz.effects.ST[S,Unit]">(</a><a href="#401674" title="Int">i</a>, <a href="#401673" title="(v1: A,v2: B)A" id="35418">f</a>(<a href="#401683" title="A">x</a>, <a href="#401675" title="B">v</a>))
  } <span class="keyword">yield</span> <span title="Unit">(</span>)
}

/** 
 * Purely functional mutable state threads.
 * Based on JL and SPJ's paper &quot;Lazy Functional State Threads&quot;
 */
<span class="keyword">sealed</span> <span class="keyword">trait</span> <a title="trait ST[S, A] extends java.lang.Object with ScalaObject" id="22535">ST</a>[<a title="&gt;: Nothing &lt;: Any" id="22724">S</a>, <a title="&gt;: Nothing &lt;: Any" id="22725">A</a>] <span title="ScalaObject">{</span>
  <span class="keyword">private</span>[effects] <span class="keyword">def</span> <a title="(s: scalaz.effects.World[S])(scalaz.effects.World[S], A)" id="57276">apply</a>(<a title="scalaz.effects.World[S]" id="401439">s</a>: <a href="#401785" title="scalaz.effects.World[S]">World</a>[S]): <a title="(scalaz.effects.World[S], A)" id="633">(</a>World[S], A)
  <span class="keyword">def</span> <a title="[B](g: (A) =&gt; scalaz.effects.ST[S,B])scalaz.effects.ST[S,B]" id="57277">flatMap</a>[<a title="&gt;: Nothing &lt;: Any" id="57279">B</a>](<a title="(A) =&gt; scalaz.effects.ST[S,B]" id="401497">g</a>: A =&gt; ST[S, B]): <a href="#22535" title="scalaz.effects.ST[S,B]">ST</a>[S, B] =
    <a href="#401426" title="(f: (scalaz.effects.World[S]) =&gt; (scalaz.effects.World[S], B))java.lang.Object with scalaz.effects.ST[S,B]">ST</a>(<a title="scalaz.effects.World[S]" id="401740">s</a> =&gt; <a href="#57276" title="(s: scalaz.effects.World[S])(scalaz.effects.World[S], A)">apply</a>(<a href="#401740" title="scalaz.effects.World[S]">s</a>) <span title="(scalaz.effects.World[S], B)" class="keyword">match</span> { <span title="(scalaz.effects.World[S], B)" class="keyword">case</span> (<a title="scalaz.effects.World[S]" id="401744">ns</a>, <a title="A" id="401745">a</a>) =&gt; <a href="#401497" title="(v1: A)scalaz.effects.ST[S,B]">g</a><a href="#57276" title="(s: scalaz.effects.World[S])(scalaz.effects.World[S], B)">(</a><a href="#401745" title="A">a</a>)(<a href="#401744" title="scalaz.effects.World[S]">ns</a>) })
  <span class="keyword">def</span> <a title="[B](g: (A) =&gt; B)scalaz.effects.ST[S,B]" id="57280">map</a>[<a title="&gt;: Nothing &lt;: Any" id="57282">B</a>](<a title="(A) =&gt; B" id="401030">g</a>: A =&gt; B): <a href="#22535" title="scalaz.effects.ST[S,B]">ST</a>[S, B] =
    <a href="#401426" title="(f: (scalaz.effects.World[S]) =&gt; (scalaz.effects.World[S], B))java.lang.Object with scalaz.effects.ST[S,B]">ST</a>(<a title="scalaz.effects.World[S]" id="401760">s</a> =&gt; <a href="#57276" title="(s: scalaz.effects.World[S])(scalaz.effects.World[S], A)">apply</a>(<a href="#401760" title="scalaz.effects.World[S]">s</a>) <span title="(scalaz.effects.World[S], B)" class="keyword">match</span> { <span title="(scalaz.effects.World[S], B)" class="keyword">case</span> (<a title="scalaz.effects.World[S]" id="401764">ns</a>, <a title="A" id="401765">a</a>) =&gt; <span title="(_1: scalaz.effects.World[S],_2: B)(scalaz.effects.World[S], B)">(</span><a href="#401764" title="scalaz.effects.World[S]">ns</a>, <a href="#401030" title="(v1: A)B">g</a>(<a href="#401765" title="A">a</a>)) })
}

<span class="keyword">object</span> <a title="object scalaz.effects.ST" id="22536">ST</a> <span title="ScalaObject">{</span>
  <span class="keyword">def</span> <a title="[S, A](f: (scalaz.effects.World[S]) =&gt; (scalaz.effects.World[S], A))java.lang.Object with scalaz.effects.ST[S,A]" id="401426">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="401429">S</a>, <a title="&gt;: Nothing &lt;: Any" id="401430">A</a>](<a title="(scalaz.effects.World[S]) =&gt; (scalaz.effects.World[S], A)" id="401431">f</a>: World[S] =&gt; (World[S], A)) = <a href="#401434" title="java.lang.Object with scalaz.effects.ST[S,A]" class="keyword">new</a> <a title="anonymous class $anon extends java.lang.Object with scalaz.effects.ST[S,A]" id="401434">ST</a>[S, A] {
    <span class="keyword">private</span>[effects] <span class="keyword">def</span> <a title="(s: scalaz.effects.World[S])(scalaz.effects.World[S], A)" id="401436">apply</a>(<a title="scalaz.effects.World[S]" id="401437">s</a>: <a href="#401785" title="scalaz.effects.World[S]">World</a>[S]) = <a href="#401431" title="(v1: scalaz.effects.World[S])(scalaz.effects.World[S], A)">f</a>(<a href="#401437" title="scalaz.effects.World[S]">s</a>)
  }

}


        </pre>
    </body>
</html>